<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout.html}" lang="en">
<head>
    <title>Home</title>
</head>
<body>

<main layout:fragment="content">
    <input type="hidden" id="dogId" th:value="${dog.id}">
    <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner" id="dogImages">
          <div class="carousel-item active">
            <img src="https://via.placeholder.com/200x100" class="d-block w-100" alt="...">
            <div class="carousel-caption d-none d-md-block">
                <h5>Third slide label</h5>
                <p>Some representative placeholder content for the third slide.</p>
            </div>
          </div>
          <div class="carousel-item">
            <img src="https://via.placeholder.com/200x100" class="d-block w-100" alt="...">
          </div>
          <div class="carousel-item">
            <img src="https://via.placeholder.com/200x100" class="d-block w-100" alt="...">
          </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>

      <div>
          <h3>Upload image</h3>
          <input class="" type="file" name="" id="image">
          <button class="btn btn-primary"></button>
      </div>
</main>
</body>
<script layout:fragment="script">

    let dogImages = document.getElementById("dogImages");
    let file = document.getElementById("image");
    let id = document.getElementById("dogId").value;

    function uploadImage(){
        let data = new FormData();
        data.set("file", file.files[0]);
        axios.post(`/api/dogs/${id}/pics/`, data).then(res =>{
            console.log(res);
            refreshDogs();
        })
    }


    function refreshDogs(){
        axios.get(`/api/dogs/${id}/pics/`).then( res =>{
        console.log(res.data)
        clearImages();
        res.data.forEach( (picture, i) =>{
            newImage(picture, i)
        })
    })
    }

    function clearImages(){
        dogImages.innerHTML = "";
    }
 
    function newImage(picture , i ){
        let item = document.createElement("div");
        if(i == 0){
            item.setAttribute("class","carousel-item active");
        }else{
            item.setAttribute("class","carousel-item");
        }
        

        let image = document.createElement("img");
        image.setAttribute("class","d-block w-100");
        image.src = picture.url;

        let caption = document.createElement("div")
        caption.setAttribute("class","carousel-caption d-block")
        caption.innerHTML = "Total boops: " + picture.boops.length

        item.appendChild(image);
        item.appendChild(caption);
        dogImages.appendChild(item);
    }


</script>
</html>