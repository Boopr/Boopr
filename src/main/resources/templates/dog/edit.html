<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout.html}" lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Dog</title>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.css' rel='stylesheet' />
</head>
<body>

<main layout:fragment="content">

    <input type="hidden" th:value="${#httpServletRequest.requestURI}" id="id" class="invisible">

    <div id="form">
        <h2 class="text-center">Edit dog</h2>
        <div id="imageUploader"></div>

    </div>
    
</main>

</body>
<script type="module" layout:fragment="script">

    let id = document.getElementById("id").value.split("/")
    id = id[id.length-1];


    import FormCreator from '/js/FormCreator.js';
    import MapBoxForm from '/js/MapBoxForm.js';
    import ImageCarouselUploader from '/js/ImageCarouselUploader.js'

    new ImageCarouselUploader("imageUploader",id);


    axios.get("/api/dogs/"+id).then( res =>{
        let form = new FormCreator("form","/api/dog/edit/"+ id, "put", "/user/profile");
        let mapbox = new MapBoxForm();

        
        let dog = res.data

        form.createLabel("name", "Name", );
        form.createInput("name","Dog Name","text" , dog.name)

        form.importForm(mapbox.export());
        form.importForm(mapbox.exportForm());
        mapbox.addMarker("dog")

        form.createLabel("sex", "Sex");
        if(dog.sex){
            form.createInput("sex","Male","text","Male");
        }else{
            form.createInput("sex","Male","text","Female");
        }
        

        form.createLabel("bio", "Bio");
        form.createInput("bio","Bio","text",dog.bio);

        axios.get("/api/breed").then( (res)=>{
            let obj = {
                id: "breeds",
                multiselect: "true",
                options:[]
            }
            res.data.forEach( breed =>{
                let b = {
                    value: breed.id,
                    text: breed.name,
                }

                dog.breed.forEach( d =>{
                    if(d.id == b.value){
                        b.selected = true;
                    }
                })

                obj.options.push(b)
            })
            form.createLabel("breeds", "Breeds")
            form.createSelect(obj);
        })
    })
   
    


</script>
</html>